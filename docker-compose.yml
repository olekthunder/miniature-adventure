version: '3'

x-sub1: &sub1
  build:
    context: subscriber1
    dockerfile: ../Dockerfile
  depends_on:
    - rmq

services:
  rmq:
    image: rabbitmq:3-management
    container_name: rmq
    ports:
      - 15672:15672
      - 5672:5672
  # task 1
  consumer1:
    build:
      context: consumer1
      dockerfile: ../Dockerfile
    container_name: consumer1
    depends_on:
      - rmq
  producer1:
    build:
      context: producer1
      dockerfile: ../Dockerfile
    container_name: producer1
    depends_on:
      - rmq
  publisher1:
    build:
      context: publisher1
      dockerfile: ../Dockerfile
    container_name: publisher1
    depends_on:
      - rmq
      - subscriber11
      - subscriber12
  subscriber11:
    <<: *sub1
    container_name: subscriber11
  subscriber12:
    <<: *sub1
    container_name: subscriber12
  # task 2
  client2:
    build:
      context: client2
      dockerfile: ../Dockerfile
    container_name: client2
    depends_on:
      - rmq
  worker2:
    build:
      context: worker2
      dockerfile: ../Dockerfile
    container_name: worker2
    depends_on:
      - rmq
  # task 3
  consumer31:
    build:
      context: consumer31
      dockerfile: ../Dockerfile
    container_name: consumer31
    depends_on:
      - rmq
  producer31:
    build:
      context: producer31
      dockerfile: ../Dockerfile
    container_name: producer31
    depends_on:
      - rmq
    consumer31:
    build:
      context: consumer31
      dockerfile: ../Dockerfile
    container_name: consumer31
    depends_on:
      - rmq
  producer31:
    build:
      context: producer31
      dockerfile: ../Dockerfile
    container_name: producer31
    depends_on:
      - rmq
  consumer32:
    build:
      context: consumer32
      dockerfile: ../Dockerfile
    container_name: consumer32
    depends_on:
      - rmq
  producer32:
    build:
      context: producer32
      dockerfile: ../Dockerfile
    container_name: producer32
    depends_on:
      - rmq
  # task 4
  consumer4:
    build:
      context: consumer4
      dockerfile: ../Dockerfile
    container_name: consumer4
    depends_on:
      - rmq
  producer4:
    build:
      context: producer4
      dockerfile: ../Dockerfile
    container_name: producer4
    depends_on:
      - rmq
  # task5
  consumer5:
    build:
      context: consumer5
      dockerfile: ../Dockerfile
    container_name: consumer5
    depends_on:
      - rmq
  producer5:
    build:
      context: producer5
      dockerfile: ../Dockerfile
    container_name: producer5
    depends_on:
      - rmq