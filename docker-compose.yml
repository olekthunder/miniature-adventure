version: "3"

x-hz: &hz
  image: hazelcast/hazelcast:4.0.3
  volumes: 
    - .:/hz-config
  environment:
  - JAVA_OPTS="-Dhazelcast.config=/hz-config/hazelcast.xml"

services:
  hz1:
    <<: *hz
  hz2:
    <<: *hz
  hz3:
    <<: *hz
  mgmt:
    image: hazelcast/management-center:4.0.3
    ports:
      - 8080:8080
    environment:
      - MC_HTTP_PORT=8080  
    command: "bash -c \"./mc-conf.sh cluster add -ma hz1:5701,hz2:5701,hz3:5701 -cn dev && sleep 2 && ./start.sh -v\""
    depends_on:
      - hz1
      - hz2
      - hz3
  messages_service:
    build: ./services/messages_service
    ports: 
      - 8083:8083
    env_file: env.env
  logging_service:
    build: ./services/logging_service
    ports: 
      - 8082:8082
    env_file: env.env
  facade_service:
    build: ./services/facade_service
    ports: 
      - 8081:8081
    env_file: env.env
      
networks:
  default:
    name: "hznet"